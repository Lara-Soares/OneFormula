<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>OneFormula</title>

  <link rel="stylesheet" href="css/style.css">
  <link rel="icon" href="./fotos/logo com carro.png">
</head>


<body>
    <!-- Header -->
    <div class="header">
      <div class="container">
        <div class="logo">
          <img src="./fotos/logo__3_-removebg-preview2.png" width="90px">
          <h1 class="titulo">OneFormula</h1>
        </div>
        <ul class="navbar">
          <li class="barra">
              <a href="dashboard.html">Dashboards</a>
          </li>
          <li>
            <a href="noticias.html">Notícias</a>
          </li>
        </ul>
      </div>
    </div>
  
  
  
    <!-- quiz -->
  
    <body>
      <div id="pontuacaoEJogo" class="pontuacaoEJogo">
        <div class="quiz">
          <button onclick="iniciarQuiz()" id="btnIniciarQuiz">INICIAR QUIZ</button>
          </div>
          <div id="pontuacao" class="flex-colunar width-fit-content border-primary">
              <div id="pontuacaoDuranteJogo" class="flex-colunar padding-8">
                  <span class="width-fit-content">Quantidade de acertos: <span id="spanCertas"></span></span>
                  <span class="width-fit-content">Quantidade de erros: <span id="spanErradas"></span></span>
              </div>
              <div id="pontuacaoFinalJogo" class="flex-colunar padding-8">
                  <span id="pontuacaoFinal" class="width-fit-content">Pontuação Final:
                      <span id="spanPontuacaoFinal">***</span>
                  </span>
                  <span id="msgFinal" class="width-fit-content">***</span>
              </div>
          </div>
          <br><br>
          <div id="jogo" class="width-fit-content flex-colunar border-secondary">
  
              <div id="infoQuestao" class="padding-8">
                  <span>Questão atual: <span id="spanNumeroDaQuestaoAtual"></span> de <span id="qtdQuestoes"></span>
                      questões.</span>
              </div>
  
              <div id="perguntaDaQuestaoAtual" class="padding-8">
                  <span id="spanQuestaoExibida" class="text-bold"></span>
              </div>
  
              <div id="infoAlternativas" class="padding-8">
                  <span><em>Escolha uma opção dentre as abaixo:</em></span>
              </div>
  
              <div id="opcoes" class="flex-colunar padding-8">
                  <span>
                      <input type="radio" id="primeiraOpcao" name="option" class="radio" value="alternativaA" />
                      <label for="primeiraOpcao" class="option" id="labelOpcaoUm"></label>
                  </span>
                  <span>
                      <input type="radio" id="segundaOpcao" name="option" class="radio" value="alternativaB" />
                      <label for="segundaOpcao" class="option" id="labelOpcaoDois"></label>
                  </span>
                  <span>
                      <input type="radio" id="terceiraOpcao" name="option" class="radio" value="alternativaC" />
                      <label for="terceiraOpcao" class="option" id="labelOpcaoTres"></label>
                  </span>
                  <span>
                      <input type="radio" id="quartaOpcao" name="option" class="radio" value="alternativaD" />
                      <label for="quartaOpcao" class="option" id="labelOpcaoQuatro"></label>
                  </span>
              </div>
  
              <div id="botoes" class="flex-colunar padding-8">
                  <button onclick="submeter()" id="btnSubmeter">Submeter resposta</button>
                  <button onclick="avancar()" id="btnProx" disabled>Avançar para próxima questão</button>
                  <button onclick="tentarNovamente()" id="btnTentarNovamente" disabled>Tentar novamente</button>
                  <button onclick="cadastrarResposta()" id="btnConcluir" disabled>Finalizar Quiz</button> 
  
              </div>
  
          </div>
      </div>
      <!-- footer -->
  <div class="footer">
      <div class="container">
        <h4>Lara Soares SPTech &copy; 2024</h4>
      </div>
    </div>
  
  </body>
  
  </html>
  <script>
      const listaDeQuestoes = [
  
          { id:1,
              pergunta: "Qual foi o primeiro país africano a sediar uma corrida de F1?",
              alternativaA: "Egito",
              alternativaB: "Tunísia",
              alternativaC: "Marrocos",
              alternativaD: "África do Sul",
              alternativaCorreta: "alternativaC"
          },
  
          {id:2,
              pergunta: "Quantas mulheres já participaram da F1?",
              alternativaA: "Nove",
              alternativaB: "Seis",
              alternativaC: "Oito",
              alternativaD: "Sete",
              alternativaCorreta: "alternativaA"
          },
  
          {id:3,
              pergunta: "Qual década ficou conhecida com Era Britânica?",
              alternativaA: "1970",
              alternativaB: "1960",
              alternativaC: "1990",
              alternativaD: "1950",
              alternativaCorreta: "alternativaB"
          },
  
          {id:4,
              pergunta: "Quem foi o primeiro brasileiro campeão da F1?",
              alternativaA: "José Carlos Pace",
              alternativaB: "Wilson Fittipaldi",
              alternativaC: "Emerson Fittipaldi",
              alternativaD: "Nelson Piquet",
              alternativaCorreta: "alternativaC"
          },
  
          {id:5,
              pergunta: "Quando foi realizada a primeira corrida de Fórmula 1 no Brasil?",
              alternativaA: "Autódromo de Jacarepaguá em 1978",
              alternativaB: "Autódromo de Interlagos em 1972",
              alternativaC: "Autódromo de Jacarepaguá em 1973",
              alternativaD: "Autódromo de Interlagos em 1979",
              alternativaCorreta: "alternativaB"
          },
  
          {id:6,
              pergunta: "Qual é a rivalidade que foi considerada a maior da história da Fórmula 1?",
              alternativaA: " Alain Prost e Nigel Mansell ",
              alternativaB: " Ayrton Senna e Nelson Piquet ",
              alternativaC: " Nigel Mansell e Ayrton Senna ",
              alternativaD: " Ayrton Senna e Alain Prost ",
              alternativaCorreta: "alternativaD"
          },
  
          {id:7,
              pergunta: "Qual piloto foi campeão pilotando por quatro equipes?",
              alternativaA: " Juan Manuel Fangio ",
              alternativaB: " Alberto Ascari",
              alternativaC: " Giuseppe Farina",
              alternativaD: " Luigi Fagioli",
              alternativaCorreta: "alternativaA"
          },
  
          {id:8,
              pergunta: "Qual foi o Pit Stop mais rápido da história?",
              alternativaA: " Red Bull 1,82 segundo",
              alternativaB: " McLaren  1,80 segundo",
              alternativaC: " Ferrari 2,10 segundo",
              alternativaD: " Red Bull 1,98 segundo",
              alternativaCorreta: "alternativaB"
          },
          {id:9,
              pergunta: "Um piloto perde uma média de quantos kgs durante uma corrida?",
              alternativaA: " 2kgs",
              alternativaB: " 1kg",
              alternativaC: " 1.5kgs",
              alternativaD: " 3kgs",
              alternativaCorreta: "alternativaA"
          },
  
          {id:10,
              pergunta: "O piloto mais jovem a ser campeão mundial de Fórmula 1 é:",
              alternativaA: " Lando Norris",
              alternativaB: " Max Verstappen",
              alternativaC: " Emerson Fittipaldi",
              alternativaD: " Sebastian Vettel",
              alternativaCorreta: "alternativaD"
          },
  
          {id:11,
              pergunta: "Quem ficou conhecido como Rei de Mônaco",
              alternativaA: " Ayrton Senna",
              alternativaB: " Graham Hill",
              alternativaC: " Michael Schumacher",
              alternativaD: " Lewis Hamilton",
              alternativaCorreta: "alternativaA"
          },
  
  
  
      ]
          
      // variáveis globais    
      let numeroDaQuestaoAtual = 0
      let pontuacaoFinal = 0
      let tentativaIncorreta = 0
      let certas = 0
      let erradas = 0
      let quantidadeDeQuestoes = listaDeQuestoes.length
      
  
      function cadastrarResposta(){
          var idusuario = sessionStorage.ID_USUARIO
          var pontos = certas
          for (let index = 0; index < listaDeQuestoes.length; index++) {
  
          var isCorreta = eCorreta[index];
          var idpergunta = listaDeQuestoes[index].id
  
          fetch("/resposta/cadastrar", {
              method : "POST",
              headers : {
                  "Content-Type": "application/json"
              },
              // passando informações pro controller
              body:JSON.stringify({
                  idusuario:idusuario, 
                  idpergunta:idpergunta,
                  isCorreta:isCorreta
              })
          }).then(function (resposta)
          {console.log(resposta)
              
          }).catch(function (resposta) {
              console.log(`#erro: ${resposta}`)
          })
      }
  
      fetch(`/resposta/cadastrarPontos`, {
              method : "PUT",
              headers : {
                  "Content-Type": "application/json"
              },
              // passando informações pro controller
              body:JSON.stringify({
                  idusuario:idusuario, 
                  pontos:pontos
              })
          }).then(function (resposta)
          {console.log(resposta)
              
          }).catch(function (resposta) {
              console.log(`#erro: ${resposta}`)
          })
  
      }
     
  
      function iniciarQuiz() {
          document.getElementById('pontuacao').style.display = "flex"
          document.getElementById('jogo').style.display = "flex"
          document.getElementById('btnIniciarQuiz').style.display = "none"
  
          document.getElementById('qtdQuestoes').innerHTML = quantidadeDeQuestoes
  
          preencherHTMLcomQuestaoAtual(0)
  
  // false porque tem que clicar em iniciar primeiro
          btnSubmeter.disabled = false
          btnProx.disabled = false
          btnConcluir.disabled = false
          btnTentarNovamente.disabled = false
      }
  
      function preencherHTMLcomQuestaoAtual(index) {
          habilitarAlternativas(true)
          const questaoAtual = listaDeQuestoes[index]
          numeroDaQuestaoAtual = index
  
          console.log("questaoAtual")
          console.log(questaoAtual)
  
          document.getElementById("spanNumeroDaQuestaoAtual").innerHTML = Number(index) + 1 // ajustando porque o index começa em 0
          document.getElementById("spanQuestaoExibida").innerHTML = questaoAtual.pergunta;
          document.getElementById("labelOpcaoUm").innerHTML = questaoAtual.alternativaA;
          document.getElementById("labelOpcaoDois").innerHTML = questaoAtual.alternativaB;
          document.getElementById("labelOpcaoTres").innerHTML = questaoAtual.alternativaC;
          document.getElementById("labelOpcaoQuatro").innerHTML = questaoAtual.alternativaD;
      }
  
      function submeter() { //ir para a próxima pergunta depois de ter escolhido alguma opção
          const options = document.getElementsByName("option"); // recupera alternativas no html
  
          let hasChecked = false
          for (let i = 0; i < options.length; i++) {
              if (options[i].checked) {
                  hasChecked = true
                  break
              }
          }
  
          if (!hasChecked) { 
              alert("Não há alternativas escolhidas. Escolha uma opção.")
          } else {
              btnSubmeter.disabled = true
              btnProx.disabled = false
  
              habilitarAlternativas(false)
  
              checarResposta()
          }
      }
  
      function habilitarAlternativas(trueOrFalse) {
          let opcaoEscolhida = trueOrFalse ? false : true
  
          primeiraOpcao.disabled = opcaoEscolhida
          segundaOpcao.disabled = opcaoEscolhida
          terceiraOpcao.disabled = opcaoEscolhida
          quartaOpcao.disabled = opcaoEscolhida
  
      }
  
      function avancar() { // vai para a próxima questão
          btnProx.disabled = true
          btnSubmeter.disabled = false
  
          desmarcarRadioButtons()
  
          if (numeroDaQuestaoAtual < quantidadeDeQuestoes - 1) {
              preencherHTMLcomQuestaoAtual(numeroDaQuestaoAtual)
          } else if (numeroDaQuestaoAtual == quantidadeDeQuestoes - 1) {
              alert("Atenção... a próxima é a ultima questão!")
              preencherHTMLcomQuestaoAtual(numeroDaQuestaoAtual)
          } else {
              finalizarJogo()
          }
          limparCoresBackgroundOpcoes()
      }
  
      function tentarNovamente() {
          // atualiza a página
          window.location.reload()
      }
      var eCorreta = []
      function checarResposta() {
          const questaoAtual = listaDeQuestoes[numeroDaQuestaoAtual] // questão atual 
          const respostaQuestaoAtual = questaoAtual.alternativaCorreta // qual é a resposta correta da questão atual
  
          const options = document.getElementsByName("option"); // recupera alternativas no html
  
          let alternativaCorreta = null // variável para armazenar a alternativa correta
  
          options.forEach((option) => {
              if (option.value === respostaQuestaoAtual) {
                  console.log("alternativaCorreta está no componente: " + alternativaCorreta)
                  alternativaCorreta = option.labels[0].id
              }
          })
  
          // verifica se resposta assinalada é correta
          options.forEach((option) => {
              if (option.checked === true && option.value === respostaQuestaoAtual) {
                  document.getElementById(alternativaCorreta).classList.add("text-success-with-bg")
                  //dash
                  pontuacaoFinal++
                  certas++
                  eCorreta.push('1')
                  document.getElementById("spanCertas").innerHTML = certas
                  numeroDaQuestaoAtual++
  
              } else if (option.checked && option.value !== respostaQuestaoAtual) {
                  const wrongLabelId = option.labels[0].id
                  document.getElementById(wrongLabelId).classList.add("text-danger-with-bg")
                  document.getElementById(alternativaCorreta).classList.add("text-success-with-bg")
                  //dash
                  tentativaIncorreta++
                  erradas++
                  eCorreta.push('0')
                  document.getElementById("spanErradas").innerHTML = erradas
                  numeroDaQuestaoAtual++
              }
          })
      }
  
      function limparCoresBackgroundOpcoes() {
          const options = document.getElementsByName("option");
          options.forEach((option) => {
              document.getElementById(option.labels[0].id).classList.remove("text-danger-with-bg")
              document.getElementById(option.labels[0].id).classList.remove("text-success-with-bg")
          })
      }
  
      function desmarcarRadioButtons() {
          const options = document.getElementsByName("option");
          for (let i = 0; i < options.length; i++) {
              options[i].checked = false;
          }
      }
  
      function finalizarJogo() {
          let textoParaMensagemFinal = null
          let classComCoresParaMensagemFinal = null
          const porcentagemFinalDeAcertos = pontuacaoFinal / quantidadeDeQuestoes
  
          if (porcentagemFinalDeAcertos <= 0.3) {
              textoParaMensagemFinal = "Parece que você está no fim do grid..."
              classComCoresParaMensagemFinal = "text-danger-with-bg"
          }
          else if (porcentagemFinalDeAcertos > 0.3 && porcentagemFinalDeAcertos < 0.9) {
              textoParaMensagemFinal = "Pode melhorar na próxima, hein!"
              classComCoresParaMensagemFinal = "text-warning-with-bg"
          }
          else if (porcentagemFinalDeAcertos >= 0.9) {
              textoParaMensagemFinal = "Uau, parabéns você está na frente do grid!"
              classComCoresParaMensagemFinal = "text-success-with-bg"
          }
          
          textoParaMensagemFinal += "<br> Você acertou " + Math.round((porcentagemFinalDeAcertos)*100) + "% das questões."
  
  
          document.getElementById('msgFinal').innerHTML = textoParaMensagemFinal
          document.getElementById('msgFinal').classList.add(classComCoresParaMensagemFinal) 
          document.getElementById('spanPontuacaoFinal').innerHTML = pontuacaoFinal
  
          document.getElementById('jogo').classList.add("text-new-gray") 
  
      
  
          // btnProx.disabled = true
          // btnSubmeter.disabled = true
          // btnTentarNovamente.disabled = false
          // btnConcluir.disabled = false
      }
  </script>